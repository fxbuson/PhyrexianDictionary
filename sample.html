---
layout: internal
title: Dictionary Entry
---

<div class="sample-img">
    <img id='sample'>
</div>
<div class="sample-info">
    <div class="divider"></div>
    
    <p id='english'></p>

    <div id="searchable" onpointerup="selection_search()">
        <p id="phy_0" class='phyrexian phy_fonted' ></p>
        <p id="phy_1" class='phyrexian'></p>
    </div>

    <p id='breakdown'></p>

    <p><b>Notes:</b></p>
    <p id='notes'></p>

    <div class="divider"></div>
    
    <p><b>Query:</b> <span id="query-region">Select some phyrexian text...</span></p>
    
    <div id="search-results"></div>

    <div class="divider"></div>
    
</div>
<script>
    // Get the current URL
    const url = new URL(window.location.href);
    
    // Get the search parameters from the URL
    const params = new URLSearchParams(url.search);
    
    // Retrieve a specific variable
    const id = params.get('id');

    const json = `{{ site.data.PhyrexianAPI | jsonify }}`
    const data = JSON.parse(json)

    document.getElementById('sample').setAttribute('src', 'images/' + data.samples[id].Name + '.jpg')
    
    var phy_instances = document.getElementsByClassName("phyrexian")
    for (var i = 0; i < phy_instances.length; i++) {
        phy_instances[i].innerHTML = data.samples[id].Regular;
    }
    document.getElementById('english').innerHTML = data.samples[id].English
    document.getElementById('notes').innerHTML = data.samples[id].Notes
    document.getElementById('breakdown').innerHTML = data.samples[id].Breakdown

    document.title = data.samples[id].Name + ' - Phyrexian Dictionary';

    function change_color(obj, col){
        var items = document.getElementsByClassName(obj.className)
        for(var index=0;index < items.length;index++){
            items[index].style.color = col;
        }
    }

    function unvowel(phy){
        const vowels = 'aeiouyøɒə';
        for (v in vowels){
            phy = phy.replaceAll(vowels[v], '');
        }
        return phy;
    }

    function unmetalize(phy){
        const metalics = [['t','ţť'], ['g', 'ǥǧ'], ['k', 'ķǩ'], ['p', 'φπ']];

        for (cons in metalics){
            console.log(metalics[cons][0])
            for (variant in metalics[cons][1]){
                console.log(metalics[cons][variant])
                phy = phy.replaceAll(metalics[cons][variant], metalics[cons][0]);
            }
        }
        return phy;
    }

    function selection_search(){
        const sel = rangy.getSelection(document.getElementById('searchable'));
        var query = ''
        if (sel.rangeCount > 1){      
            query = '';  
        }
        else{
            query = sel.toString();
        }

        var previous = document.getElementsByClassName('color-changed');

        for(var index=0;index < previous.length;index++){
            var text = document.createTextNode(previous[index].innerText);
            previous[index].parentNode.replaceChild(text, previous[index]);
        }

        document.getElementById('search-results').innerHTML = '';
        if (query == ''){
            document.getElementById('query-region').innerHTML = 'Select some phyrexian text...';
        }
        else if(sel.focusNode != sel.anchorNode){
            document.getElementById('query-region').innerHTML = 'Please select from a single section';
        }
        else{
            document.getElementById('query-region').innerHTML = query;
            const simplified_query = unmetalize(unvowel(query));
            console.log('query:');
            console.log(simplified_query);
            for (idx in data.dictionary){
                let word = data.dictionary[idx].phyrexian;
                let simplified_word = unmetalize(unvowel(word));
                switch (data.dictionary[idx].type){
                    case 'number':
                    case 'marker':
                        if (query.includes(word)){
                            document.getElementById('search-results').innerHTML += '<p><span class="phy_fonted">'+ word +'</span> - <a href="{{site.baseurl}}/entry?id='+ idx +'">'+ word +'</a> - '+ data.dictionary[idx].translation +'</p>';
                        }
                        break;
                    default:
                        if (simplified_query.includes(simplified_word)){
                            document.getElementById('search-results').innerHTML += '<p><span class="phy_fonted">'+ word +'</span> - <a href="{{site.baseurl}}/entry?id='+ idx +'">'+ word +'</a> - '+ data.dictionary[idx].translation +'</p>';
                        }
                }
            }
            switch (sel.focusNode.parentNode.id){
                case 'phy_0':
                    target = document.getElementById('phy_1');
                    break;
                case 'phy_1':
                    target = document.getElementById('phy_0')
            }

            range = rangy.createRange()
            range.setStart(target.firstChild, Math.min(sel.anchorOffset, sel.focusOffset))
            range.setEnd(target.firstChild, Math.max(sel.anchorOffset, sel.focusOffset))
            sel.addRange(range)
        }
        
    }
    
</script>
